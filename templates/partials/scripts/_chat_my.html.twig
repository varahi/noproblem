<script>
    var userInfo = {
        //username: new Date().getTime().toString()
        fromUserId: 'Test ' + {{ fromUser.id }},
        {% if toUser is not null %}
            toUserId: 'Test ' + {{ toUser.id }}
        {% endif %}
    };
    /* var form = document.getElementById('submit-form');
    var messageArea = document.getElementById("form-message");
    var messagesList = document.getElementById('messages-list');
     */

    // Socket chat configuration
    /**
     * @type WebSocket
     */
    var socket = new WebSocket("ws://127.0.0.1:8080");

    socket.onopen = function(event) {
        console.info("Connection status OK!");
    };

    socket.onmessage = function(event) {
        var data = JSON.parse(event.data);
        ChatController.addMessage(data.fromUserId, data.toUserId, data.message);

        console.log(data);
    };

    socket.onerror = function(error){
        alert("Something is wrong with your connection.");
        console.error(error);
    };
    // Socket chat config end


    /// Adding messages to the list element
    document.getElementById("form-submit").addEventListener("click",function(){
        var msg = document.getElementById("form-message").value;

        if(!msg){
            alert("You haven't written anything yet!");
        }

        ChatController.sendMessage(msg);
        // Clear out the text field.
        document.getElementById("form-message").value = "";
    }, false);


    // Send the message and add it to a list.
    var ChatController = {
        addMessage: function(fromUserId,toUserId, message){
            var from;
            //from = "From user id " + userInfo.fromUserId;

            if(fromUserId === userInfo.fromUserId){
                 //from = "From me";
                from = "From user id " + userInfo.fromUserId;
            } else {
                from = "From user id " + userInfo.toUserId;
            }

            //from = userInfo.username;
            var ul = document.getElementById("messages-list");
            var li = document.createElement("li");
            li.appendChild(document.createTextNode(from + " : "+ message));
            ul.appendChild(li);
        },
        sendMessage: function(text){
            userInfo.message = text;
            socket.send(JSON.stringify(userInfo));
            this.addMessage(userInfo.fromUserId, userInfo.toUserId, userInfo.message);
        }
    };
</script>